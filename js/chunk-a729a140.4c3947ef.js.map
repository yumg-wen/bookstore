{"version":3,"sources":["webpack:///./src/views/order/createOrder.vue","webpack:///./src/network/order.js","webpack:///./src/views/order/createOrder.vue?d369","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/views/order/createOrder.vue?26f9"],"names":["class","alt","_createElementVNode","_createVNode","_component_nav_bar","default","onClick","$setup","_toDisplayString","_ctx","name","phone","province","city","county","address","_component_van_icon","_createElementBlock","_Fragment","_renderList","item","index","key","goods","cover_url","title","num","_hoisted_12","price","_component_van_submit_bar","button-text","onSubmit","_component_van_popup","closeable","close-on-click-overlay","show","$event","position","style","height","onClose","_component_van_grid","border","column-num","_component_van_grid_item","_component_van_image","width","src","createOrder","params","request","url","method","getOrderPreview","payOrder","order","payOrderStatus","components","navBar","setup","store","useStore","router","useRoute","useRouter","state","reactive","cartList","showPay","orderNo","aliyun","init","loading","message","forbidClick","then","res","filter","n","is_default","length","carts","clear","onMounted","goTo","push","path","close","handleCreateOrder","address_id","id","dispatch","type","qr_code_url","timer","setInterval","clearInterval","query","total","computed","sum","forEach","parseInt","parseFloat","toRefs","__exports__","render","DESCRIPTORS","FUNCTION_NAME_EXISTS","EXISTS","uncurryThis","defineProperty","f","FunctionPrototype","Function","prototype","functionToString","toString","nameRE","regExpExec","exec","NAME","configurable","get","this","error"],"mappings":"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","file":"js/chunk-a729a140.4c3947ef.js","sourcesContent":["<template>\r\n  <div class=\"create-order\">\r\n     <nav-bar>\r\n       <template v-slot:default>訂單預覽</template>\r\n     </nav-bar>\r\n     <div class=\"address-wrap\">\r\n       <div class=\"name\" @click=\"goTo\">\r\n         <span>{{address.name}}</span>\r\n         <span>{{address.phone}}</span>\r\n       </div>\r\n       <div class=\"address\">\r\n        {{address.province}}{{address.city}}{{address.county}}{{address.address}}\r\n       </div>\r\n       <van-icon name=\"arrow\" @click=\"goTo\"/>\r\n     </div>\r\n     <div class=\"good\">\r\n       <div class=\"good-item\" v-for=\"item,index in cartList\" :key=\"index\">\r\n         <div class=\"good-img\"><img v-lazy=\"item.goods.cover_url\" alt=\"\"></div>\r\n         <div class=\"good-desc\">\r\n           <div class=\"good-title\">\r\n             <span>{{item.goods.title}}</span>\r\n             <span>x1{{item.num}}</span>\r\n           </div>\r\n           <div class=\"good-btn\">\r\n             <div class=\"price\"><small>$</small>{{item.goods.price}}</div>\r\n           </div>\r\n         </div>\r\n       </div>\r\n     </div>\r\n  </div>\r\n  <van-submit-bar \r\n      class=\"submit-all\"\r\n      :price=\"total*100\" \r\n      button-text=\"提交訂單\" \r\n      @submit=\"handleCreateOrder\" >\r\n    商品金額\r\n  </van-submit-bar>\r\n\r\n   <van-popup\r\n       closeable\r\n       :close-on-click-overlay='false'\r\n       v-model:show=\"showPay\"\r\n       position=\"bottom\"\r\n       :style=\"{height:'40%'}\"\r\n       @close='close'\r\n>\r\n   <van-grid :border=\"false\" :column-num=\"2\">\r\n     <van-grid-item>\r\n       QRCode<br>\r\n     <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n    </van-grid-item>\r\n    <van-grid-item>\r\n       轉帳 <br>\r\n      <van-image  width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n    </van-grid-item>\r\n \r\n</van-grid>\r\n\r\n   </van-popup>\r\n</template>\r\n\r\n<script>\r\nimport navBar from 'components/common/navbar/NavBar.vue'\r\nimport {getOrderPreview,payOrder,payOrderStatus,createOrder} from 'network/order'\r\nimport {reactive,toRefs,ref,computed,onMounted} from'vue'\r\nimport {Toast} from 'vant'\r\nimport {useRoute,useRouter} from 'vue-router'\r\nimport {useStore} from 'vuex'\r\nexport default {\r\n  name:'cerateOrder',\r\n  components:{navBar},\r\n  setup(){\r\n    const store=useStore()\r\n    const route=useRoute()\r\n    const router=useRouter()\r\n    const state=reactive({\r\n      cartList:[],\r\n      address:{},\r\n      showPay:false,\r\n      orderNo:'',\r\n      aliyun:''\r\n    })\r\n    const init=()=>{\r\n      Toast.loading({message:\"加載中...\",forbidClick:true})\r\n      //獲取訂單數據\r\n      getOrderPreview().then(res=>{\r\n        // console.log(res)\r\n        //獲取地址訊息\r\n        let address=res.address.filter(n=>n.is_default=='1')\r\n        if(address.length==0){\r\n          state.address={\r\n            address:\"未有寄送地址，請選擇或添加地址\"\r\n          }\r\n        }else{\r\n          state.address=address[0]\r\n        }\r\n        //獲取購物車商品訊息\r\n        state.cartList=res.carts\r\n        Toast.clear()\r\n      })\r\n    }\r\n    onMounted(()=>{\r\n      init()\r\n    })\r\n\r\n    const goTo=()=>{\r\n      router.push({path:'/address'})\r\n    }\r\n    const close=()=>{}\r\n    const handleCreateOrder=()=>{\r\n      const params={\r\n        address_id:state.address.id\r\n      }\r\n        createOrder(params).then(res=>{\r\n          Toast('創建成功')\r\n          store.dispatch('updateCar')\r\n          state.showPay=true\r\n          //訂單id\r\n          state.orderNo=res.id\r\n          payOrder(state.orderNo,{type:'aliyun'}).then(res=>{\r\n            state.aliyun=res.qr_code_url\r\n            })\r\n\r\n          //支付完成查看\r\n          const timer=setInterval(()=>{\r\n            payOrderStatus(state.orderNo).then(res=>{\r\n              if(res==2){\r\n                clearInterval(timer)\r\n                router.push({path:'/order',query:{state:2}})\r\n              }\r\n            })\r\n          },2000)\r\n        })\r\n    }\r\n\r\n   //計算總價\r\n   const total=computed(()=>{\r\n     let sum=0\r\n     state.cartList.forEach(item=>{\r\n       sum+=parseInt(item.num)*parseFloat(item.goods.price)\r\n     })\r\n     return sum\r\n   })\r\n    return{\r\n      ...toRefs(state),goTo,close,handleCreateOrder,total\r\n    }\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style lang='less'>\r\n.create-order{\r\n  background: #f9f9f9;\r\n  .address-wrap{\r\n    text-align: center;\r\n    margin-bottom: 20px;\r\n    background: #fff;\r\n    position: relative;\r\n    margin-top: 44px;\r\n    font-size: 14px;\r\n    padding: 15px;\r\n    color: #222333;\r\n    .name,.address{\r\n      margin: 10px 0;\r\n    }\r\n    .arrow{\r\n      position: absolute;\r\n      right: 10px;\r\n      top: 50%;\r\n      transform: translateY((-50%));\r\n      font-size: 20px;\r\n    }\r\n}\r\n.good{\r\n  margin-bottom: 120px;\r\n}\r\n.good-item{\r\n  padding: 10px;\r\n  background: #fff;\r\n  display: flex;\r\n  .good-img{\r\n    width: 100%;\r\n    height: auto;\r\n  }\r\n  .good-desc{\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    flex: 1;\r\n    padding: 20px;\r\n    .good-title{\r\n      display: flex;\r\n      justify-content: space-between;\r\n    }\r\n    .good-btn{\r\n      display: flex;\r\n      justify-content: space-between;\r\n      .price{\r\n        font-size: 16px;\r\n        color: red;\r\n        line-height: 28px;\r\n      }\r\n      \r\n    }\r\n  }\r\n}\r\n\r\n}\r\n\r\n</style>","import {request} from './request'\r\n//創建訂單(後端以提供創建完，移除購物車項目)\r\nexport function createOrder (params){\r\n  return request({\r\n    url:'/api/orders',\r\n    method:'post',\r\n    params\r\n  })\r\n}\r\n\r\n//獲取訂單預覽\r\nexport function getOrderPreview (){\r\n  return request({\r\n    url:'/api/orders/preview'\r\n  })\r\n} \r\n//訂單支付,獲取二維碼 \r\nexport function payOrder (order,params){\r\n  return request({\r\n    url:`/api/orders/${order}/pay`,\r\n    params\r\n    \r\n  })\r\n}\r\n//訂單狀態\r\nexport function payOrderStatus (order){\r\n  return request({\r\n    url:`/api/orders/${order}/status`,\r\n    \r\n  })\r\n}\r\n//訂單列表 {page:1, state:2 ,include:'user,orderDetail'}\r\nexport function getOrderList (params){\r\n  return request({\r\n    url:'/api/orders',\r\n    params\r\n   \r\n  })\r\n}\r\n//創建訂單詳情\r\nexport function createOrderDetail (order){\r\n  return request({\r\n    url:`/api/orders/${order}`,\r\n    params:{\r\n      include:'user,orderDetails.goods'\r\n    }\r\n  })\r\n}\r\n\r\n//確認訂單\r\nexport function confirmOrder (order){\r\n  return request({\r\n    url:`/api/orders/${order}/confirm`,\r\n    method:'patch',\r\n  })}\r\n//獲取物流訊息\r\n  export function viewExpress (order){\r\n    return request({\r\n      url:`/api/orders/${order}/express`,\r\n    \r\n    })}","import { render } from \"./createOrder.vue?vue&type=template&id=e88fcb4a\"\nimport script from \"./createOrder.vue?vue&type=script&lang=js\"\nexport * from \"./createOrder.vue?vue&type=script&lang=js\"\n\nimport \"./createOrder.vue?vue&type=style&index=0&id=e88fcb4a&lang=less\"\n\nimport exportComponent from \"C:\\\\Users\\\\meime\\\\OneDrive\\\\Desktop\\\\book\\\\book-store\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","var DESCRIPTORS = require('../internals/descriptors');\nvar FUNCTION_NAME_EXISTS = require('../internals/function-name').EXISTS;\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar functionToString = uncurryThis(FunctionPrototype.toString);\nvar nameRE = /function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/;\nvar regExpExec = uncurryThis(nameRE.exec);\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !FUNCTION_NAME_EXISTS) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return regExpExec(nameRE, functionToString(this))[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./createOrder.vue?vue&type=style&index=0&id=e88fcb4a&lang=less\""],"sourceRoot":""}