{"version":3,"sources":["webpack:///./src/views/category/Category.vue?34e8","webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?8ea9"],"names":["class","_createVNode","_component_nav_bar","default","_createElementVNode","_component_van_sidebar","$setup","$event","_component_van_collapse","accordion","_createElementBlock","_Fragment","_renderList","item","_createBlock","_component_van_collapse_item","key","id","title","name","children","sub","_component_van_sidebar_item","onClick","_component_van_tabs","active","_component_van_tab","_component_van_card","num","comments_count","tag","price","desc","updated_at","thumb","cover_url","lazy-load","_component_back_top","getCategory","request","url","getCategoryGoods","order","page","components","navBar","backTop","setup","router","useRouter","isBackTop","ref","categories","activeKey","activeName","currentOrder","currentId","goods","reactive","sales","list","showGoods","computed","value","init","then","res","data","recommend_goods","bscroll","onMounted","goodList","document","querySelector","BScroll","probeType","click","pullUpLoad","on","position","y","push","finishPullUp","nextTick","refresh","console","log","clientHeight","clickTab","index","orders","getGoods","watchEffect","scrollTo","itemClick","path","query","__exports__","render"],"mappings":"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","file":"js/chunk-56ea6eb8.6fa7b120.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Category.vue?vue&type=style&index=0&id=0259d1d2&lang=less&scoped=true\"","<template>\r\n  <!-- 頂部 -->\r\n  <nav-bar>\r\n    <template v-slot:default>我的分類</template>\r\n  </nav-bar>\r\n  <div class=\"main-box\">\r\n    <!-- 左側菜單欄利用插件(摺疊面板+側編導欄)分兩級 -->\r\n    <van-sidebar v-model=\"activeKey\" class=\"left-menu\">\r\n      <van-collapse v-model=\"activeName\" accordion>\r\n        <van-collapse-item v-for=\"item in categories\" :key=\"item.id\" :title=\"item.name\" :name=\"item.name\">\r\n          <!-- 子級 -->\r\n            <van-sidebar-item \r\n             v-for=\"sub in item.children\" :key=\"sub.id\" :title=\"sub.name\"\r\n             @click=\"getGoods(sub.id)\"  />\r\n        </van-collapse-item>\r\n      </van-collapse>\r\n    </van-sidebar>\r\n    <!-- 上部選項利用Tab標籤頁 -->\r\n    <div class=\"order-tab\">\r\n     <van-tabs v-model:active=\"active\" @click=\"clickTab\">\r\n      <van-tab title=\"銷量排序\"></van-tab>\r\n      <van-tab title=\"價格排序\"></van-tab>\r\n     <van-tab title=\"評論排序\"></van-tab>\r\n     </van-tabs>\r\n    </div>\r\n    <!-- 使用better-scroll  good-list為外層固定高容器-->\r\n    <div class=\"goodList\">\r\n      <div class=\"content\">\r\n        <van-card\r\n        v-for=\"item in showGoods\" :key=\"item.id\"\r\n        @click=\"itemClick(item.id)\"\r\n        :num=\"item.comments_count \"\r\n        :tag=\"item.comments_count >=3?'流行':'推薦'\"\r\n        :price=\"item.price\"\r\n        :desc=\"item.updated_at\"\r\n        :title=\"item.title\"\r\n        :thumb=\"item.cover_url\"\r\n        :lazy-load=\"true\"\r\n        />\r\n      </div>\r\n    </div>\r\n   <!-- 底部出現向上箭頭 -->\r\n   <back-top v-show=\"isBackTop\" @click=\"backTop\"></back-top>\r\n  </div>\r\n   \r\n    \r\n</template>\r\n\r\n<script>\r\nimport navBar from 'components/common/navbar/NavBar.vue'\r\nimport backTop from 'components/common/backtop/backTop.vue'\r\nimport {getCategory,getCategoryGoods} from 'network/category.js'\r\nimport {useRouter} from 'vue-router'\r\nimport {ref,reactive,onMounted, computed,watchEffect,nextTick}from 'vue'\r\nimport BScroll from 'better-scroll'\r\nexport default {\r\n  name:'CateGory',\r\n  components:{navBar,backTop},\r\n  setup(){\r\n    const router =useRouter()\r\n    let isBackTop=ref(false)\r\n    let categories= ref ([])\r\n    // 默認值以vant設定為主\r\n    let activeKey=ref(0)\r\n    let activeName=ref(1)\r\n    let active=ref(1)\r\n\r\n    //當前排序條件(默認sales)\r\n    let currentOrder=ref('sales')\r\n    //當前分類的id(默認0)\r\n    let currentId=ref(0)\r\n\r\n    //數據模型(上拉加載、sales、price...等數據)\r\n    const goods=reactive({\r\n      sales:{page:1,list:[]},\r\n      price:{page:1,list:[]},\r\n      comments_count:{page:1,list:[]},\r\n    })\r\n    //通過計算屬性，order-tab顯示相對應的數據\r\n    const showGoods=computed(()=>{\r\n      //點擊選項卡顯示對應數據 \r\n      return goods[currentOrder.value].list\r\n    })\r\n\r\n    //通過初始化 getCategoryGoods獲取細項數據\r\n    const init=()=>{\r\n      getCategoryGoods('sales',currentId.value).then(res=>{\r\n       goods.sales.list=res.goods.data})\r\n      getCategoryGoods('price',currentId.value).then(res=>{\r\n       goods.price.list=res.recommend_goods})\r\n      getCategoryGoods('comments_count',currentId.value).then(res=>{\r\n       goods.comments_count.list=res.recommend_goods})\r\n     \r\n    }\r\n    let bscroll=reactive({});\r\n\r\n    onMounted(()=>{\r\n      getCategory().then(res=>{\r\n          // console.log(res)\r\n        categories.value=res.categories\r\n      })\r\n      //頁面加載所有值後調用 init()\r\n      init()\r\n\r\n      //創建BScroll\r\n      let goodList=document.querySelector('.goodList')\r\n      bscroll = new BScroll(goodList ,{\r\n        probeType:3,  //只要運行滾動就會觸發\r\n        click:true,  //商品的連結允許可點擊 預設為false\r\n        pullUpLoad:true,  //上拉加載更多  預設為false\r\n      })\r\n    \r\n      //註冊滾動事件\r\n      bscroll.on('scroll',(position)=>{\r\n       isBackTop.value=(-position.y)>800\r\n      })\r\n\r\n      //螢幕上滑(pillingUp)到底時，數據加載更多\r\n      bscroll.on('pullingUp',()=>{\r\n        // console.log(\"加載更多成功\")\r\n        const page=goods[currentOrder.value].page+1\r\n\r\n        getCategoryGoods(currentOrder.value,currentId.value).then(res=>{\r\n          //用push()新增頁往後加而非取代前頁\r\n           goods[currentOrder.value].list.push(...res.goods.data)\r\n           goods[currentOrder.value].page+=1\r\n        \r\n      })  \r\n        //上拉到底後，須等數據加載完，呈現新數據\r\n        bscroll.finishPullUp()\r\n\r\n        nextTick(()=>{\r\n         //高度一有變化，立馬重新計算高度(refresh)\r\n        // bscroll &&  bscroll.refresh()\r\n       bscroll && bscroll.refresh()\r\n        console.log('計算成功')\r\n      })\r\n        // //一滾動，就重新計算高度\r\n        // bscroll.refresh()\r\n        //content高度\r\n         console.log('當前高度'+document.querySelector(\".content\").clientHeight)\r\n         console.log(\"當前類型\"+currentOrder.value+\",當前頁面\"+page)\r\n      })\r\n    })\r\n    //點選項卡排列\r\n    const clickTab=(index)=>{\r\n      let orders=['sales','price','comments_count']\r\n      currentOrder.value=orders[index]\r\n      getCategoryGoods('sales',currentId.value).then(res=>{\r\n       goods.sales.list=res.goods.data})\r\n\r\n       bscroll && bscroll.refresh()\r\n      \r\n    }\r\n    \r\n    //通過分類(子級)得到商品\r\n    const getGoods=(id)=>{currentId.value=id\r\n      //點擊選項卡後調用init()\r\n      init()\r\n      // console.log('當前分類id:'+currentId.value)\r\n      // console.log('排列序號:'+currentOrder.value)\r\n    }\r\n\r\n    //監聽高度變化\r\n     watchEffect(()=>{\r\n      //等整個dom元素加載完(nextTicket)才重新計算\r\n      nextTick(()=>{\r\n         //高度一有變化，立馬重新計算高度(refresh)\r\n        // bscroll &&  bscroll.refresh()\r\n       bscroll && bscroll.refresh()\r\n        console.log('計算成功')\r\n      })\r\n\r\n     })\r\n     const backTop=()=>{\r\n        bscroll.scrollTo(0,0,300)\r\n     }\r\n    return{activeKey,categories,activeName,active,isBackTop,backTop,\r\n    clickTab,currentOrder,currentId,getGoods,goods,showGoods,bscroll,\r\n    itemClick:(id)=>{\r\n      router.push({path:\"/detail\",query:{id}})\r\n    }}\r\n  }\r\n}\r\n\r\n\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n.main-box{\r\n   display: flex;\r\n   margin-top: 3.125rem;\r\n   .order-tab{\r\n    position: fixed;\r\n    top: 2.5rem;\r\n    right: 0;\r\n    width:15.625rem;\r\n    height: 1.875rem;\r\n    z-index: 10;\r\n  }\r\n  .left-menu{\r\n    position: fixed;\r\n    top: 5.9375rem;\r\n    left: 0;\r\n    height: auto;\r\n    width:auto;\r\n  }\r\n\r\n  .goodList{\r\n    font: .0625rem;\r\n    position: absolute;\r\n    top:6.875rem;\r\n    right: 0;\r\n    width:15.625rem;\r\n    height: 100vh;\r\n   .content{\r\n     padding-top: 5.3125rem;\r\n     \r\n   }\r\n   \r\n  } \r\n}\r\n@media (mix-width:750px) {\r\n  .main-box .order-tab {\r\n    width: 60rem;\r\n    position: fixed;\r\n    left: 12.5rem !important;\r\n    font-size: 1.25rem;\r\n  }\r\n  .goodList .content{\r\n    width: 50rem;\r\n  }\r\n  \r\n}\r\n</style>","import {request} from './request.js'\r\n\r\n// 獲取分類所有資訊 getCategory()\r\nexport function getCategory(){\r\n return request({\r\n     url:'/api/goods',\r\n     \r\n  })\r\n}\r\n\r\n// 獲取選項卡分類\"細項\"資訊 getCategoryGoods(銷量排序，分類搜索，分頁)帶參數\r\nexport function getCategoryGoods(order=\"sales\",id=0,page=1){\r\n  return request({\r\n      url:`/api/goods?category_id=${id}&page=${page}&order=${order}`\r\n     \r\n   })\r\n }","import { render } from \"./Category.vue?vue&type=template&id=0259d1d2&scoped=true\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=0259d1d2&lang=less&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\meime\\\\OneDrive\\\\Desktop\\\\book\\\\book-store\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-0259d1d2\"]])\n\nexport default __exports__"],"sourceRoot":""}